---
layout: post
title:  Git amend arbitrary commits
date:   2015-02-17
tags: git bash utility
---
Using Git on a daily basis, and rebasing commit history nearly as much,
led me to ask the question: Why doesn't `git --amend` work with arbitrary
commits?

For example, imagine being able to stage some changes, and then squash them
with `git-amend HEAD~1` or `git-amend 279923e`.

I imagined that this ability wouldn't be much different from a fixup
commit that was immediately squashed into the target commit. With that in
mind, I created a [shell script to do just this][gist].

{% highlight bash %}
#!/bin/bash
set -e

# Boilerplate template reference:
# https://github.com/oxyc/bash-boilerplate/blob/master/script.sh

sha1=""
version="0.1"

usage() {
    echo -n "$(basename $0) [OPTION]... [SHA1]

Commit index then immediately squash into target SHA1.

Options:
  -h, --help        Display this help and exit
      --version     Output version information and exit
"
}

# Print help if no arguments were passed.
[[ $# -eq 0 ]] && set -- "--help"

# Read the options and set stuff
while [[ $1 = -?* ]]; do
  case $1 in
    -h|--help) usage >&2; exit 0 ;;
    --version) echo "$version"; exit 0 ;;
    *) echo "Invalid option: $1" >&2; exit 1 ;;
  esac
  shift
done

sha1=$1
shift

set -x
git commit --fixup $sha1
git rebase -p -i --autosquash $sha1~2
{% endhighlight %}

The biggest drawback is that you can't stage more than 1 fixup at a time
since it rebases history. However, I would argue that similar to
`git --amend`, this utility is designed for a narrow use-case and
shouldn't be expected to handle anything more complicated.

What I learned is that *rebasing is complicated*. There's a reason that
`git --amend` doesn't work like this out of the box, and the reason is probably
that *this command is only marginally useful for minor changes, and
useless for non-trivial fixups*.

While this command was not as useful as I expected it to be, I still use
it at least once or twice per week, and plan to continue experimenting
with it and hopefully come up with some better ideas on how to improve
its usefulness.


[gist]: https://gist.github.com/kdeloach/03e0244419833365cd8c